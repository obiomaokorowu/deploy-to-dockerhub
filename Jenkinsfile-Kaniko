  
pipeline {
  agent {
     label "kaniko"
  }

  environment {
       imagename = "austinobioma/december-docker"
       registryCredential = 'DockerHub'
       dockerImage = ''
           }

     stages {

          stage ('Build') {
              agent {
                label "maven"
              }
           steps {
             script{
               container('maven'){
           sh 'mvn clean package'
                }
            }
          }
        }   

          stage('Building Docker image') {
                    agent{
                      label "kaniko"
                    }
               steps{
                   script {
                     container('kaniko'){
                       sh '''/kaniko/executor --dockerfile `pwd`/ Dockerfile \
                                            --context `pwd` \
                                            --destination=$imagename:${BUILD_NUMBER}
                       '''
                          }
                   }
               }
          }

          // stage('Deploy Image') {
          //      steps{
          //            script {
          //                docker.withRegistry( '', registryCredential ) {
          //                dockerImage.push("$BUILD_NUMBER")
          //                dockerImage.push('latest')
          //                                     }
          //                }
          //      }
          // }

          // stage('Remove Unused docker image') {
          //      steps{
          //           sh "docker rmi $imagename:$BUILD_NUMBER"
          //           sh "docker rmi $imagename:latest"
          //           }
          // }
    
     }
}
